<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Kwitariusz Szko≈Çy - System ZarzƒÖdzania P≈Çatno≈õci</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            --color-primary: #667eea;
            --color-secondary: #764ba2;
            --color-bg: #f5f5f5;
            --color-surface: #ffffff;
            --color-text: #333;
            --color-text-light: #999;
            --color-border: #e0e0e0;
        }
        
        body.dark-mode {
            --color-bg: #1a1a1a;
            --color-surface: #2d2d2d;
            --color-text: #e0e0e0;
            --color-text-light: #aaa;
            --color-border: #444;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: var(--color-bg);
            color: var(--color-text);
            transition: all 0.3s;
        }
        
        /* Sidebar */
        .sidebar {
            position: fixed;
            left: 0;
            top: 0;
            width: 250px;
            height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            overflow-y: auto;
            z-index: 1000;
            display: flex;
            flex-direction: column;
        }
        
        .sidebar-header {
            margin-bottom: 30px;
        }
        
        .sidebar h1 {
            font-size: 18px;
            font-weight: 600;
        }
        
        .sidebar-nav {
            flex: 1;
        }
        
        .sidebar a {
            display: block;
            padding: 12px 15px;
            color: white;
            text-decoration: none;
            border-radius: 5px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 14px;
        }
        
        .sidebar a:hover {
            background: rgba(255,255,255,0.2);
            transform: translateX(5px);
        }
        
        .sidebar a.active {
            background: rgba(255,255,255,0.3);
            font-weight: 600;
        }
        
        .sidebar-footer {
            text-align: center;
            font-size: 11px;
            color: rgba(255,255,255,0.7);
            padding-top: 20px;
            border-top: 1px solid rgba(255,255,255,0.2);
        }
        
        /* Main Content */
        main {
            margin-left: 250px;
            padding: 30px;
            min-height: 100vh;
            transition: all 0.3s;
        }
        
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            background: var(--color-surface);
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .header h2 {
            font-size: 24px;
            color: var(--color-text);
        }
        
        .header-right {
            display: flex;
            gap: 15px;
            align-items: center;
        }
        
        .theme-toggle {
            background: none;
            border: none;
            font-size: 20px;
            cursor: pointer;
            transition: transform 0.3s;
        }
        
        .theme-toggle:hover {
            transform: scale(1.2);
        }
        
        /* Sections */
        .section {
            display: none;
        }
        
        .section.active {
            display: block;
            animation: fadeIn 0.3s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: var(--color-surface);
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .stat-card .icon {
            font-size: 40px;
            margin-right: 15px;
        }
        
        .stat-card .label {
            font-size: 12px;
            color: var(--color-text-light);
            text-transform: uppercase;
        }
        
        .stat-card .value {
            font-size: 24px;
            font-weight: bold;
            color: var(--color-text);
        }
        
        /* Table */
        .table-container {
            background: var(--color-surface);
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
            margin-bottom: 30px;
        }
        
        .table-container h3 {
            padding: 20px;
            border-bottom: 1px solid var(--color-border);
            margin: 0;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        thead {
            background: var(--color-bg);
        }
        
        th, td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid var(--color-border);
            color: var(--color-text);
        }
        
        th {
            font-weight: 600;
            color: var(--color-text);
        }
        
        tr:hover {
            background: var(--color-bg);
        }
        
        /* Forms */
        .form-container {
            background: var(--color-surface);
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--color-text);
        }
        
        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--color-border);
            border-radius: 5px;
            font-size: 14px;
            font-family: inherit;
            background: var(--color-surface);
            color: var(--color-text);
            transition: all 0.3s;
        }
        
        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        /* Buttons */
        button, .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background: #667eea;
            color: white;
        }
        
        .btn-primary:hover {
            background: #5568d3;
        }
        
        .btn-secondary {
            background: #e0e0e0;
            color: #333;
        }
        
        .btn-secondary:hover {
            background: #d0d0d0;
        }
        
        .btn-danger {
            background: #ff6b6b;
            color: white;
            padding: 5px 10px;
            font-size: 12px;
        }
        
        .btn-danger:hover {
            background: #ee5a52;
        }
        
        .btn-sm {
            padding: 5px 10px;
            font-size: 12px;
        }
        
        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 40px;
            color: var(--color-text-light);
        }
        
        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }
        
        .modal.show {
            display: flex;
        }
        
        .modal-content {
            background: var(--color-surface);
            border-radius: 10px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .modal-header h2 {
            margin: 0;
            color: var(--color-text);
        }
        
        .close-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--color-text-light);
        }
        
        .modal-footer {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            justify-content: flex-end;
        }
        
        .action-buttons {
            display: flex;
            gap: 5px;
        }
        
        @media (max-width: 768px) {
            .sidebar {
                width: 200px;
            }
            
            main {
                margin-left: 200px;
                padding: 15px;
            }
            
            .stats-grid {
                grid-template-columns: 1fr 1fr;
            }
        }
        
        @media (max-width: 600px) {
            .sidebar {
                position: fixed;
                left: -200px;
                transition: left 0.3s;
                z-index: 2000;
                width: 200px;
            }
            
            .sidebar.show {
                left: 0;
            }
            
            main {
                margin-left: 0;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            table {
                font-size: 12px;
            }
            
            th, td {
                padding: 8px;
            }
        }
    </style>
</head>
<body>
    <!-- Sidebar Navigation -->
    <aside class="sidebar">
        <div class="sidebar-header">
            <h1>üìä Kwitariusz</h1>
        </div>
        
        <nav class="sidebar-nav">
            <a href="#dashboard" class="nav-item active" data-section="dashboard">üìä Dashboard</a>
            <a href="#placowka" class="nav-item" data-section="placowka">üè¢ Dane Plac√≥wki</a>
            <a href="#grupy" class="nav-item" data-section="grupy">üë• Grupy</a>
            <a href="#rodzice" class="nav-item" data-section="rodzice">üë®üë© Rodzice</a>
            <a href="#dzieci" class="nav-item" data-section="dzieci">üëß Dzieci</a>
            <a href="#stawki" class="nav-item" data-section="stawki">üí∞ Stawki</a>
            <a href="#obecnosci" class="nav-item" data-section="obecnosci">üìÖ Obecno≈õci</a>
            <a href="#platnosci" class="nav-item" data-section="platnosci">üí≥ P≈Çatno≈õci</a>
            <a href="#raporty" class="nav-item" data-section="raporty">üìä Raporty</a>
            <a href="#import" class="nav-item" data-section="import">üì§ Import Danych</a>
            <a href="#backup" class="nav-item" data-section="backup">üíæ Backup</a>
        </nav>
        
        <div class="sidebar-footer">
            <p>¬© 2025 IGO-NET</p>
            <p>Kwitariusz v1.0</p>
        </div>
    </aside>

    <!-- Main Content -->
    <main>
        <div class="header">
            <h2 id="page-title">üìä Dashboard</h2>
            <div class="header-right">
                <button class="theme-toggle" id="themeToggle" title="Zmie≈Ñ motyw">üåô</button>
                <span>Admin</span>
            </div>
        </div>

        <!-- DASHBOARD SECTION -->
        <section id="dashboard" class="section active">
            <div class="stats-grid">
                <div class="stat-card">
                    <div>
                        <div class="label">Rodzice</div>
                        <div class="value" id="parentsCount">0</div>
                    </div>
                    <div class="icon">üë®üë©</div>
                </div>
                
                <div class="stat-card">
                    <div>
                        <div class="label">Dzieci</div>
                        <div class="value" id="childrenCount">0</div>
                    </div>
                    <div class="icon">üëß</div>
                </div>
                
                <div class="stat-card">
                    <div>
                        <div class="label">Op≈Çacone</div>
                        <div class="value" id="totalPaid">0 z≈Ç</div>
                    </div>
                    <div class="icon">‚úÖ</div>
                </div>
                
                <div class="stat-card">
                    <div>
                        <div class="label">Zaleg≈Ço≈õci</div>
                        <div class="value" id="totalDebt">0 z≈Ç</div>
                    </div>
                    <div class="icon">‚ö†Ô∏è</div>
                </div>
            </div>
            
            <div class="table-container">
                <h3>Ostatnie P≈Çatno≈õci</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Rodzic</th>
                            <th>Dziecko</th>
                            <th>Kwota</th>
                            <th>Data</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody id="recentPaymentsTable">
                        <tr>
                            <td colspan="5" class="empty-state">Brak p≈Çatno≈õci</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>

        <!-- DANE PLAC√ìWKI SECTION -->
        <section id="placowka" class="section">
            <div class="form-container">
                <h3>Dane Plac√≥wki</h3>
                <form id="placowkaForm">
                    <div class="form-group">
                        <label>Nazwa Plac√≥wki *</label>
                        <input type="text" id="placowkaNazwa" required>
                    </div>
                    <div class="form-group">
                        <label>Adres</label>
                        <input type="text" id="placowkaAdres">
                    </div>
                    <div class="form-group">
                        <label>Telefon</label>
                        <input type="tel" id="placowkaTelefon">
                    </div>
                    <div class="form-group">
                        <label>Email</label>
                        <input type="email" id="placowkaEmail">
                    </div>
                    <button type="submit" class="btn-primary">Zapisz</button>
                </form>
            </div>
        </section>

        <!-- GRUPY SECTION -->
        <section id="grupy" class="section">
            <button class="btn-primary" id="addGroupBtn">+ Dodaj Grupƒô/Klasƒô</button>
            <div class="table-container" style="margin-top: 20px;">
                <h3>Grupy/Klasy</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Nazwa</th>
                            <th>Opis</th>
                            <th>Akcje</th>
                        </tr>
                    </thead>
                    <tbody id="groupsTable">
                        <tr>
                            <td colspan="3" class="empty-state">Brak grup</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>

        <!-- RODZICE SECTION -->
        <section id="rodzice" class="section">
            <button class="btn-primary" id="addParentBtn">+ Dodaj Rodzica</button>
            <div class="table-container" style="margin-top: 20px;">
                <h3>Rodzice</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Imiƒô</th>
                            <th>Nazwisko</th>
                            <th>Telefon</th>
                            <th>Email</th>
                            <th>Akcje</th>
                        </tr>
                    </thead>
                    <tbody id="parentsTable">
                        <tr>
                            <td colspan="5" class="empty-state">Brak rodzic√≥w</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>

        <!-- DZIECI SECTION -->
        <section id="dzieci" class="section">
            <button class="btn-primary" id="addChildBtn">+ Dodaj Dziecko</button>
            <div class="table-container" style="margin-top: 20px;">
                <h3>Dzieci</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Imiƒô</th>
                            <th>Nazwisko</th>
                            <th>Klasa</th>
                            <th>Rodzice</th>
                            <th>Akcje</th>
                        </tr>
                    </thead>
                    <tbody id="childrenTable">
                        <tr>
                            <td colspan="5" class="empty-state">Brak dzieci</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>

        <!-- STAWKI SECTION -->
        <section id="stawki" class="section">
            <button class="btn-primary" id="addRateBtn">+ Dodaj Stawkƒô</button>
            <div class="table-container" style="margin-top: 20px;">
                <h3>Stawki</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Grupa</th>
                            <th>Kategoria</th>
                            <th>Kwota</th>
                            <th>Od</th>
                            <th>Do</th>
                            <th>Akcje</th>
                        </tr>
                    </thead>
                    <tbody id="ratesTable">
                        <tr>
                            <td colspan="6" class="empty-state">Brak stawek</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>

        <!-- OBECNO≈öCI SECTION -->
        <section id="obecnosci" class="section">
            <div class="form-container">
                <h3>Obecno≈õci</h3>
                <p>Kalendarz obecno≈õci bƒôdzie tutaj</p>
            </div>
        </section>

        <!-- P≈ÅATNO≈öCI SECTION -->
        <section id="platnosci" class="section">
            <button class="btn-primary" id="addPaymentBtn">+ Dodaj P≈Çatno≈õƒá</button>
            <div class="table-container" style="margin-top: 20px;">
                <h3>P≈Çatno≈õci</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Rodzic</th>
                            <th>Dziecko</th>
                            <th>Kwota</th>
                            <th>Data</th>
                            <th>Status</th>
                            <th>Akcje</th>
                        </tr>
                    </thead>
                    <tbody id="paymentsTable">
                        <tr>
                            <td colspan="6" class="empty-state">Brak p≈Çatno≈õci</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>

        <!-- RAPORTY SECTION -->
        <section id="raporty" class="section">
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
                <div style="background: var(--color-surface); padding: 20px; border-radius: 10px; text-align: center; cursor: pointer; box-shadow: 0 2px 10px rgba(0,0,0,0.1);" id="reportArrears">
                    <div style="font-size: 40px; margin-bottom: 10px;">‚ö†Ô∏è</div>
                    <h4>Raport Zaleg≈Ço≈õci</h4>
                </div>
                <div style="background: var(--color-surface); padding: 20px; border-radius: 10px; text-align: center; cursor: pointer; box-shadow: 0 2px 10px rgba(0,0,0,0.1);" id="reportPayments">
                    <div style="font-size: 40px; margin-bottom: 10px;">‚úÖ</div>
                    <h4>Raport P≈Çatno≈õci</h4>
                </div>
                <div style="background: var(--color-surface); padding: 20px; border-radius: 10px; text-align: center; cursor: pointer; box-shadow: 0 2px 10px rgba(0,0,0,0.1);" id="reportInvoice">
                    <div style="font-size: 40px; margin-bottom: 10px;">üìÑ</div>
                    <h4>Rachunek</h4>
                </div>
                <div style="background: var(--color-surface); padding: 20px; border-radius: 10px; text-align: center; cursor: pointer; box-shadow: 0 2px 10px rgba(0,0,0,0.1);" id="reportStats">
                    <div style="font-size: 40px; margin-bottom: 10px;">üìà</div>
                    <h4>Statystyki</h4>
                </div>
            </div>
        </section>

        <!-- IMPORT SECTION -->
        <section id="import" class="section">
            <div class="form-container">
                <h3>Import Danych</h3>
                <div class="form-group">
                    <label>Import z Pliku CSV/XLSX</label>
                    <input type="file" id="importFile" accept=".csv,.xlsx">
                </div>
                <button class="btn-primary" id="importBtn">Importuj</button>
            </div>
        </section>

        <!-- BACKUP SECTION -->
        <section id="backup" class="section">
            <div class="form-container">
                <h3>Backup i Restore</h3>
                <div style="margin-bottom: 20px;">
                    <button class="btn-primary" id="backupBtn">Utw√≥rz Backup</button>
                    <button class="btn-secondary" style="margin-left: 10px;" id="restoreBtn">Przywr√≥ƒá Backup</button>
                </div>
                <h4 style="margin-top: 30px; margin-bottom: 15px;">Historia Backup√≥w</h4>
                <table>
                    <thead>
                        <tr>
                            <th>Nazwa</th>
                            <th>Rozmiar</th>
                            <th>Data</th>
                            <th>Akcje</th>
                        </tr>
                    </thead>
                    <tbody id="backupsTable">
                        <tr>
                            <td colspan="4" class="empty-state">Brak backup√≥w</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>
    </main>

    <!-- MODAL: Dodaj Rodzica -->
    <div id="addParentModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Dodaj Rodzica</h2>
                <button class="close-btn" onclick="closeModal('addParentModal')">‚úï</button>
            </div>
            <form id="addParentForm">
                <div class="form-group">
                    <label>Imiƒô *</label>
                    <input type="text" id="parentFirstName" required>
                </div>
                <div class="form-group">
                    <label>Nazwisko *</label>
                    <input type="text" id="parentLastName" required>
                </div>
                <div class="form-group">
                    <label>Telefon</label>
                    <input type="tel" id="parentPhone" placeholder="np. 123456789">
                </div>
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" id="parentEmail" placeholder="np. rodzic@email.com">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn-secondary" onclick="closeModal('addParentModal')">Anuluj</button>
                    <button type="submit" class="btn-primary">Dodaj</button>
                </div>
            </form>
        </div>
    </div>

    <!-- MODAL: Dodaj Dziecko -->
    <div id="addChildModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Dodaj Dziecko</h2>
                <button class="close-btn" onclick="closeModal('addChildModal')">‚úï</button>
            </div>
            <form id="addChildForm">
                <div class="form-group">
                    <label>Imiƒô *</label>
                    <input type="text" id="childFirstName" required>
                </div>
                <div class="form-group">
                    <label>Nazwisko *</label>
                    <input type="text" id="childLastName" required>
                </div>
                <div class="form-group">
                    <label>Klasa *</label>
                    <select id="childGroup" required>
                        <option value="">-- Wybierz klasƒô --</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>G≈Ç√≥wny rodzic *</label>
                    <select id="childParent1" required>
                        <option value="">-- Wybierz g≈Ç√≥wnego rodzica --</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Drugi rodzic (opcjonalnie)</label>
                    <select id="childParent2">
                        <option value="">-- Bez drugiego rodzica --</option>
                    </select>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn-secondary" onclick="closeModal('addChildModal')">Anuluj</button>
                    <button type="submit" class="btn-primary">Dodaj</button>
                </div>
            </form>
        </div>
    </div>

    <!-- MODAL: Dodaj Grupƒô -->
    <div id="addGroupModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Dodaj Grupƒô/Klasƒô</h2>
                <button class="close-btn" onclick="closeModal('addGroupModal')">‚úï</button>
            </div>
            <form id="addGroupForm">
                <div class="form-group">
                    <label>Nazwa Grupy/Klasy *</label>
                    <input type="text" id="groupName" placeholder="np. Klasa 1a" required>
                </div>
                <div class="form-group">
                    <label>Opis</label>
                    <input type="text" id="groupDescription" placeholder="np. Grupy przedszkolne">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn-secondary" onclick="closeModal('addGroupModal')">Anuluj</button>
                    <button type="submit" class="btn-primary">Dodaj</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Scripts -->
    <script>
// ============ GLOBAL STATE ============
let placowkaId = 1;
let parents = [];
let children = [];
let groups = [];
let placowka = null;
let currentSection = 'dashboard';

// ============ CHECK IF ELECTRON ============
const isElectron = typeof window !== 'undefined' && typeof window.ipcRenderer !== 'undefined';

// ============ THEME TOGGLE ============
const themeToggle = document.getElementById('themeToggle');
themeToggle.addEventListener('click', () => {
    document.body.classList.toggle('dark-mode');
    localStorage.setItem('theme', document.body.classList.contains('dark-mode') ? 'dark' : 'light');
    updateThemeIcon();
});

function updateThemeIcon() {
    if (document.body.classList.contains('dark-mode')) {
        themeToggle.textContent = '‚òÄÔ∏è';
    } else {
        themeToggle.textContent = 'üåô';
    }
}

// Load saved theme
if (localStorage.getItem('theme') === 'dark') {
    document.body.classList.add('dark-mode');
}
updateThemeIcon();

// ============ MODAL FUNCTIONS ============
function openModal(modalId) {
    document.getElementById(modalId).classList.add('show');
}

function closeModal(modalId) {
    document.getElementById(modalId).classList.remove('show');
}

// Close modal on outside click
document.querySelectorAll('.modal').forEach(modal => {
    modal.addEventListener('click', (e) => {
        if (e.target === modal) {
            modal.classList.remove('show');
        }
    });
});

// ============ NAVIGATION ============
document.querySelectorAll('.nav-item').forEach(item => {
    item.addEventListener('click', (e) => {
        e.preventDefault();
        
        // Remove active from all
        document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
        document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
        
        // Add active to clicked
        item.classList.add('active');
        const sectionId = item.getAttribute('data-section');
        const section = document.getElementById(sectionId);
        if (section) {
            section.classList.add('active');
            document.getElementById('page-title').textContent = item.textContent;
            
            // Load data for section
            if (sectionId === 'rodzice') loadParents();
            if (sectionId === 'dzieci') loadChildren();
            if (sectionId === 'grupy') loadGroups();
            if (sectionId === 'placowka') loadPlacowka();
        }
    });
});

// ============ INIT ============
document.addEventListener('DOMContentLoaded', () => {
    loadDashboard();
    setupEventListeners();
    loadGroups();
});

// ============ EVENT LISTENERS ============
function setupEventListeners() {
    // Dane Plac√≥wki
    document.getElementById('placowkaForm').addEventListener('submit', savePlacowka);
    
    // Add buttons
    document.getElementById('addParentBtn').addEventListener('click', () => {
        document.getElementById('addParentForm').reset();
        openModal('addParentModal');
    });

    document.getElementById('addChildBtn').addEventListener('click', () => {
        if (parents.length === 0) {
            alert('‚ö†Ô∏è Najpierw dodaj rodzica!');
            return;
        }
        document.getElementById('addChildForm').reset();
        populateParentSelects();
        openModal('addChildModal');
    });

    document.getElementById('addGroupBtn').addEventListener('click', () => {
        document.getElementById('addGroupForm').reset();
        openModal('addGroupModal');
    });

    // Forms
    document.getElementById('addParentForm').addEventListener('submit', addParent);
    document.getElementById('addChildForm').addEventListener('submit', addChild);
    document.getElementById('addGroupForm').addEventListener('submit', addGroup);
}

// ============ PLAC√ìWKA ============
async function loadPlacowka() {
    try {
        if (isElectron && window.ipcRenderer) {
            const data = await window.ipcRenderer.invoke('getPlacowka');
            if (data) {
                document.getElementById('placowkaNazwa').value = data.nazwa || '';
                document.getElementById('placowkaAdres').value = data.adres || '';
                document.getElementById('placowkaTelefon').value = data.telefon || '';
                document.getElementById('placowkaEmail').value = data.email || '';
                placowka = data;
            }
        }
    } catch (error) {
        console.error('Error loading placowka:', error);
    }
}

async function savePlacowka(e) {
    e.preventDefault();
    
    const data = {
        nazwa: document.getElementById('placowkaNazwa').value,
        adres: document.getElementById('placowkaAdres').value,
        telefon: document.getElementById('placowkaTelefon').value,
        email: document.getElementById('placowkaEmail').value
    };

    try {
        if (isElectron && window.ipcRenderer) {
            await window.ipcRenderer.invoke('addPlacowka', data);
            alert('‚úÖ Dane plac√≥wki zapisane pomy≈õlnie!');
            placowka = data;
        } else {
            alert('‚úÖ Dane plac√≥wki zapisane (lokalnie)!');
            placowka = data;
        }
    } catch (error) {
        console.error('Error saving placowka:', error);
        alert('‚ùå B≈ÇƒÖd przy zapisywaniu danych plac√≥wki!');
    }
}

// ============ LOAD DATA ============
async function loadDashboard() {
    try {
        let rodziceCount = parents.length;
        let dzieciCount = children.length;
        
        if (isElectron && window.ipcRenderer) {
            try {
                const stats = await window.ipcRenderer.invoke('getStatystyki', 1);
                rodziceCount = stats.liczba_rodzicow || 0;
                dzieciCount = stats.liczba_dzieci || 0;
            } catch (e) {
                console.log('Stats not available yet');
            }
        }
        
        document.getElementById('parentsCount').textContent = rodziceCount;
        document.getElementById('childrenCount').textContent = dzieciCount;
        document.getElementById('totalPaid').textContent = '0 z≈Ç';
        document.getElementById('totalDebt').textContent = '0 z≈Ç';
    } catch (error) {
        console.error('Error loading dashboard:', error);
    }
}

async function loadParents() {
    try {
        if (isElectron && window.ipcRenderer) {
            const data = await window.ipcRenderer.invoke('getRodzice', 1);
            parents = data.map(p => ({
                id: p.id,
                firstName: p.imie,
                lastName: p.nazwisko,
                email: p.email,
                phone: p.telefon,
                address: p.adres
            }));
        }
        renderParentsTable();
    } catch (error) {
        console.error('Error loading parents:', error);
        renderParentsTable();
    }
}

async function loadChildren() {
    try {
        if (isElectron && window.ipcRenderer) {
            const data = await window.ipcRenderer.invoke('getDzieci');
            children = data.map(d => ({
                id: d.id,
                firstName: d.imie,
                lastName: d.nazwisko,
                parentId: d.rodzic_id,
                parent2Id: d.rodzic_id_2 || null,
                group: d.grupa_id,
                birthDate: d.data_urodzenia
            }));
        }
        renderChildrenTable();
    } catch (error) {
        console.error('Error loading children:', error);
        renderChildrenTable();
    }
}

async function loadGroups() {
    try {
        if (isElectron && window.ipcRenderer) {
            const data = await window.ipcRenderer.invoke('getGrupy', 1);
            groups = data;
        }
        renderGroupsTable();
        populateGroupSelect();
    } catch (error) {
        console.error('Error loading groups:', error);
        renderGroupsTable();
        populateGroupSelect();
    }
}

// ============ RENDER TABLES ============
function renderParentsTable() {
    const tbody = document.getElementById('parentsTable');
    if (parents.length === 0) {
        tbody.innerHTML = '<tr><td colspan="5" class="empty-state">Brak rodzic√≥w</td></tr>';
        return;
    }

    tbody.innerHTML = parents.map((parent, idx) => `
        <tr>
            <td>${parent.firstName}</td>
            <td>${parent.lastName}</td>
            <td>${parent.phone || '-'}</td>
            <td>${parent.email || '-'}</td>
            <td>
                <div class="action-buttons">
                    <button class="btn-danger btn-sm" onclick="deleteParent(${parent.id || idx})">Usu≈Ñ</button>
                </div>
            </td>
        </tr>
    `).join('');
}

function renderChildrenTable() {
    const tbody = document.getElementById('childrenTable');
    if (children.length === 0) {
        tbody.innerHTML = '<tr><td colspan="5" class="empty-state">Brak dzieci</td></tr>';
        return;
    }

    tbody.innerHTML = children.map((child, idx) => {
        const parent1 = parents.find(p => p.id === child.parentId);
        const parent2 = child.parent2Id ? parents.find(p => p.id === child.parent2Id) : null;
        
        let parentText = parent1 ? `${parent1.firstName} ${parent1.lastName}` : '-';
        if (parent2) {
            parentText += `, ${parent2.firstName} ${parent2.lastName}`;
        }
        
        // Find group name
        const groupObj = groups.find(g => g.id === child.group);
        const groupName = groupObj ? groupObj.nazwa || groupObj.name : '-';
        
        return `
            <tr>
                <td>${child.firstName}</td>
                <td>${child.lastName}</td>
                <td>${groupName}</td>
                <td>${parentText}</td>
                <td>
                    <div class="action-buttons">
                        <button class="btn-danger btn-sm" onclick="deleteChild(${child.id || idx})">Usu≈Ñ</button>
                    </div>
                </td>
            </tr>
        `;
    }).join('');
}

function renderGroupsTable() {
    const tbody = document.getElementById('groupsTable');
    if (groups.length === 0) {
        tbody.innerHTML = '<tr><td colspan="3" class="empty-state">Brak grup</td></tr>';
        return;
    }

    tbody.innerHTML = groups.map((group, idx) => `
        <tr>
            <td>${group.nazwa || group.name}</td>
            <td>${group.opis || group.description || '-'}</td>
            <td>
                <div class="action-buttons">
                    <button class="btn-danger btn-sm" onclick="deleteGroup(${group.id})">Usu≈Ñ</button>
                </div>
            </td>
        </tr>
    `).join('');
}

// ============ ADD/DELETE FUNCTIONS ============
async function addParent(e) {
    e.preventDefault();
    
    const data = {
        placowka_id: 1,
        imie: document.getElementById('parentFirstName').value,
        nazwisko: document.getElementById('parentLastName').value,
        email: document.getElementById('parentEmail').value,
        telefon: document.getElementById('parentPhone').value,
        adres: '',
        miasto: '',
        kod_pocztowy: ''
    };

    try {
        if (isElectron && window.ipcRenderer) {
            await window.ipcRenderer.invoke('addRodzic', data);
        }
        
        parents.push({
            firstName: data.imie,
            lastName: data.nazwisko,
            email: data.email,
            phone: data.telefon,
            address: data.adres
        });
        
        closeModal('addParentModal');
        await loadParents();
        updateDashboard();
        alert('‚úÖ Rodzic dodany pomy≈õlnie!');
    } catch (error) {
        console.error('Error adding parent:', error);
        alert('‚ùå B≈ÇƒÖd przy dodawaniu rodzica!');
    }
}

async function deleteParent(id) {
    if (confirm('Na pewno chcesz usunƒÖƒá tego rodzica?')) {
        try {
            if (isElectron && window.ipcRenderer && id > 0) {
                await window.ipcRenderer.invoke('deleteRodzic', id);
            } else {
                parents = parents.filter((_, idx) => idx !== id);
            }
            await loadParents();
            updateDashboard();
        } catch (error) {
            console.error('Error deleting parent:', error);
        }
    }
}

async function addChild(e) {
    e.preventDefault();
    
    const parentIdx = document.getElementById('childParent1').value;
    const parent2Idx = document.getElementById('childParent2').value;
    
    if (!parentIdx) {
        alert('‚ö†Ô∏è Wybierz g≈Ç√≥wnego rodzica!');
        return;
    }

    const parent1 = parents[parentIdx];
    const parent1Id = parent1.id || parseInt(parentIdx) + 1;
    
    let parent2Id = null;
    if (parent2Idx) {
        const parent2 = parents[parent2Idx];
        parent2Id = parent2.id || parseInt(parent2Idx) + 1;
    }

    const groupValue = document.getElementById('childGroup').value;

    const data = {
        rodzic_id: parent1Id,
        rodzic_id_2: parent2Id,
        grupa_id: groupValue ? parseInt(groupValue) : null,
        imie: document.getElementById('childFirstName').value,
        nazwisko: document.getElementById('childLastName').value,
        data_urodzenia: ''
    };

    try {
        if (isElectron && window.ipcRenderer) {
            await window.ipcRenderer.invoke('addDziecko', data);
        }
        
        children.push({
            firstName: data.imie,
            lastName: data.nazwisko,
            parentId: parent1Id,
            parent2Id: parent2Id,
            group: data.grupa_id,
            birthDate: ''
        });
        
        closeModal('addChildModal');
        await loadChildren();
        updateDashboard();
        alert('‚úÖ Dziecko dodane pomy≈õlnie!');
    } catch (error) {
        console.error('Error adding child:', error);
        alert('‚ùå B≈ÇƒÖd przy dodawaniu dziecka!');
    }
}

async function deleteChild(id) {
    if (confirm('Na pewno chcesz usunƒÖƒá to dziecko?')) {
        try {
            if (isElectron && window.ipcRenderer && id > 0) {
                await window.ipcRenderer.invoke('deleteDziecko', id);
            } else {
                children = children.filter((_, idx) => idx !== id);
            }
            await loadChildren();
            updateDashboard();
        } catch (error) {
            console.error('Error deleting child:', error);
        }
    }
}

async function addGroup(e) {
    e.preventDefault();
    
    const data = {
        placowka_id: 1,
        nazwa: document.getElementById('groupName').value,
        opis: document.getElementById('groupDescription').value
    };

    try {
        if (isElectron && window.ipcRenderer) {
            const result = await window.ipcRenderer.invoke('addGrupa', data);
            data.id = result.lastInsertRowid;
        } else {
            data.id = groups.length + 1;
        }
        
        groups.push(data);
        
        closeModal('addGroupModal');
        await loadGroups();
        alert('‚úÖ Grupa dodana pomy≈õlnie!');
    } catch (error) {
        console.error('Error adding group:', error);
        alert('‚ùå B≈ÇƒÖd przy dodawaniu grupy!');
    }
}

async function deleteGroup(id) {
    if (confirm('Na pewno chcesz usunƒÖƒá tƒô grupƒô?')) {
        try {
            if (isElectron && window.ipcRenderer) {
                await window.ipcRenderer.invoke('deleteGrupa', id);
            } else {
                groups = groups.filter(g => g.id !== id);
            }
            await loadGroups();
        } catch (error) {
            console.error('Error deleting group:', error);
        }
    }
}

function populateParentSelects() {
    const select1 = document.getElementById('childParent1');
    const select2 = document.getElementById('childParent2');
    
    select1.innerHTML = '<option value="">-- Wybierz g≈Ç√≥wnego rodzica --</option>';
    select2.innerHTML = '<option value="">-- Bez drugiego rodzica --</option>';
    
    parents.forEach((parent, idx) => {
        const option1 = document.createElement('option');
        option1.value = idx;
        option1.textContent = `${parent.firstName} ${parent.lastName}`;
        select1.appendChild(option1);
        
        const option2 = document.createElement('option');
        option2.value = idx;
        option2.textContent = `${parent.firstName} ${parent.lastName}`;
        select2.appendChild(option2);
    });
}

function populateGroupSelect() {
    const select = document.getElementById('childGroup');
    select.innerHTML = '<option value="">-- Wybierz klasƒô --</option>';
    
    groups.forEach((group) => {
        const option = document.createElement('option');
        option.value = group.id;
        option.textContent = group.nazwa || group.name;
        select.appendChild(option);
    });
}

function updateDashboard() {
    document.getElementById('parentsCount').textContent = parents.length;
    document.getElementById('childrenCount').textContent = children.length;
}
    </script>
</body>
</html>
